pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        spec:
          containers:
          - name: python-podman
            image: docker.io/javapig/demo-app:jmeter
            command:
            - cat
            tty: true
            securityContext:
              runAsUser: 0
            magePullPolicy: Always
          imagePullSecrets:
          - name: my-registry-key
        '''
    }
  }
   stages {
    stage('Run build image') {
            steps {
              container('python-podman') {
                sh "ls"
                sh "jmeter --version"
                sh "jmeter -n -t Jenkins-jmx.jmx -l /tmp/result.csv"
                sh "ls /tmp"
              }
            }      
     }
   }
    post {
        always {
            archiveArtifacts artifacts: '/tmp/result.csv', onlyIfSuccessful: true
        }
    }
}
